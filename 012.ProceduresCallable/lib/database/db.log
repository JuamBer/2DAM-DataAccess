/*C3*/SET SCHEMA PUBLIC
DROP PROCEDURE set_new_department IF EXISTS
DROP PROCEDURE set_new_teacher IF EXISTS
DROP PROCEDURE set_salary IF EXISTS
DROP PROCEDURE rise_salary_prct IF EXISTS
DROP PROCEDURE rise_salary_per_dept IF EXISTS
DROP PROCEDURE get_newest_teacher IF EXISTS
DROP PROCEDURE count_teachers IF EXISTS
CREATE PROCEDURE set_new_department(IN id INT, IN name VARCHAR(15), IN office VARCHAR(15)) MODIFIES SQL DATA BEGIN ATOMIC  INSERT INTO departments VALUES id,name,office; END
CREATE PROCEDURE set_new_teacher(IN id INT, IN name VARCHAR(15), IN surname VARCHAR(15), IN email VARCHAR(15), IN start_date DATE, IN id_department INT, IN salary INT) MODIFIES SQL DATA BEGIN ATOMIC  INSERT INTO teachers VALUES id,name,surname,email,start_date,id_department,salary; END
CREATE PROCEDURE set_salary(IN salar INT) MODIFIES SQL DATA BEGIN ATOMIC  UPDATE teachers SET teachers.salary=salar; END
CREATE PROCEDURE rise_salary_prct(IN p FLOAT) MODIFIES SQL DATA BEGIN ATOMIC  DECLARE OP FLOAT;  SET OP = p/100;  UPDATE teachers SET salary=salary+(salary*OP); END
CREATE PROCEDURE rise_salary_per_dept(p FLOAT, dept_name VARCHAR(15)) MODIFIES SQL DATA BEGIN ATOMIC  DECLARE OP INT;  SET OP = p/10;  UPDATE teachers SET salary = salary + (salary * OP) WHERE dept_num IN (     SELECT dept_num FROM departments WHERE name LIKE dept_name);END
CREATE PROCEDURE get_newest_teacher(OUT res VARCHAR(15)) MODIFIES SQL DATA BEGIN ATOMIC  DECLARE QUERYDATE DATE;  DECLARE QUERYNAME VARCHAR(15);  SET QUERYDATE = SELECT MAX(start_date) FROM teachers; SET QUERYNAME = SELECT name FROM teachers WHERE start_date=QUERYDATE LIMIT 1; SET res = QUERYNAME;END
CREATE PROCEDURE count_teachers(IN dept_name VARCHAR(15), OUT res INT) READS SQL DATA BEGIN ATOMIC  DECLARE NUMTEACHERS INT;  SET NUMTEACHERS = SELECT COUNT(name) FROM teachers WHERE dept_num IN (     SELECT dept_num FROM departments WHERE name LIKE dept_name); SET res = NUMTEACHERS; END
DELETE FROM TEACHERS WHERE ID=1
DELETE FROM TEACHERS WHERE ID=2
DELETE FROM TEACHERS WHERE ID=3
DELETE FROM TEACHERS WHERE ID=4
DELETE FROM TEACHERS WHERE ID=5
DELETE FROM TEACHERS WHERE ID=6
DELETE FROM TEACHERS WHERE ID=7
INSERT INTO TEACHERS VALUES(1,'Luz','Martinez','luz.martinez@iesabastos.org','1990-01-01',10,1000)
INSERT INTO TEACHERS VALUES(2,'Cristina','Ausina','c.ausina@iesabastos.org','1990-02-01',10,1000)
INSERT INTO TEACHERS VALUES(3,'Imma','Cabanes','i.cabanes@iesabastos.org','2000-03-01',10,1000)
INSERT INTO TEACHERS VALUES(4,'Mercedes','S\u00a0nchez','m.sanchez@iesabastos.org',NULL,40,1000)
INSERT INTO TEACHERS VALUES(5,'Juan','Saez','contacto','2002-08-08',50,1000)
INSERT INTO TEACHERS VALUES(6,'Ivan','Soriano','ivan@gmail.com','2001-05-08',30,1000)
INSERT INTO TEACHERS VALUES(7,'Fran','Peris','franperisemail','1999-04-06',20,1000)
COMMIT
DELETE FROM TEACHERS WHERE ID=1
DELETE FROM TEACHERS WHERE ID=2
DELETE FROM TEACHERS WHERE ID=3
DELETE FROM TEACHERS WHERE ID=4
DELETE FROM TEACHERS WHERE ID=5
DELETE FROM TEACHERS WHERE ID=6
DELETE FROM TEACHERS WHERE ID=7
INSERT INTO TEACHERS VALUES(1,'Luz','Martinez','luz.martinez@iesabastos.org','1990-01-01',10,1500)
INSERT INTO TEACHERS VALUES(2,'Cristina','Ausina','c.ausina@iesabastos.org','1990-02-01',10,1500)
INSERT INTO TEACHERS VALUES(3,'Imma','Cabanes','i.cabanes@iesabastos.org','2000-03-01',10,1500)
INSERT INTO TEACHERS VALUES(4,'Mercedes','S\u00a0nchez','m.sanchez@iesabastos.org',NULL,40,1500)
INSERT INTO TEACHERS VALUES(5,'Juan','Saez','contacto','2002-08-08',50,1500)
INSERT INTO TEACHERS VALUES(6,'Ivan','Soriano','ivan@gmail.com','2001-05-08',30,1500)
INSERT INTO TEACHERS VALUES(7,'Fran','Peris','franperisemail','1999-04-06',20,1500)
COMMIT
DELETE FROM TEACHERS WHERE ID=1
DELETE FROM TEACHERS WHERE ID=2
DELETE FROM TEACHERS WHERE ID=3
INSERT INTO TEACHERS VALUES(1,'Luz','Martinez','luz.martinez@iesabastos.org','1990-01-01',10,9000)
INSERT INTO TEACHERS VALUES(2,'Cristina','Ausina','c.ausina@iesabastos.org','1990-02-01',10,9000)
INSERT INTO TEACHERS VALUES(3,'Imma','Cabanes','i.cabanes@iesabastos.org','2000-03-01',10,9000)
COMMIT
